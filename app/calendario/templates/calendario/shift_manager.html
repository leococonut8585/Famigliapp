{% extends 'base.html' %}
{% block content %}
<style>
  .employee-box {
    cursor: pointer;
    padding: 5px 8px; /* Adjusted padding slightly for better look with border */
    margin: 2px;
    border: 1px solid #ccc;
    display: inline-block; 
    border-radius: 4px; /* Added border-radius for consistency */
    transition: background-color 0.2s ease-in-out; /* Smooth transition */
  }
  .emp-selected {
    background-color: #aaddff; /* Light blue for selected */
    font-weight: bold;
    border-color: #007bff; /* Darker blue border for selected */
  }
  .assignments span.assigned {
    display: block; /* Make each assigned employee take a new line */
    margin-bottom: 3px; /* Slightly increased margin */
    padding: 3px 5px; /* Adjusted padding */
    background-color: #e9ecef; /* Lighter grey for assigned items */
    border-radius: 3px;
    font-size: 0.9em; /* Slightly smaller font for assigned items */
  }
  /* Styling for the draggable employee boxes from static/css/style.css for reference if needed */
  /* .employee-box (from static/css/style.css) {
    border: 1px solid #2196F3;
    background: #e3f2fd;
    padding: 4px 8px;
    margin: 2px;
    display: inline-block;
    border-radius: 4px;
    cursor: move; // Note: This will be overridden by the new .employee-box cursor: pointer
  } */
  /* .shift-cell .assigned (from static/css/style.css) {
    display: block;
    background: #bbdefb;
    margin: 2px 0;
    padding: 2px 4px;
    border-radius: 4px;
    cursor: pointer;
  } */
</style>

<h1>{{ month.strftime('%Y-%m') }} シフト管理</h1>
<div>
    {% if nav_prev_month %}
        <a href="{{ url_for('calendario.shift', month=nav_prev_month.strftime('%Y-%m')) }}">&lt;</a>
    {% else %}
        <span>&lt;</span>
    {% endif %}
    {% if nav_next_month %}
        <a href="{{ url_for('calendario.shift', month=nav_next_month.strftime('%Y-%m')) }}">&gt;</a>
    {% else %}
        <span>&gt;</span>
    {% endif %}
</div>
<div class="shift-users">
{% for emp in employees %}
    {# draggable="true" might be removed if drag is fully replaced by click #}
    <div class="employee-box" draggable="true" data-emp="{{ emp }}">{{ emp }}</div>
{% endfor %}
</div>

<div class="employee-stats-summary" style="margin-bottom: 15px; padding: 10px; border: 1px solid #ccc; border-radius: 5px;">
    <h3 style="margin-top: 0;">今月の集計</h3>
    {% if employees %}
        {% for emp in employees %}
            <p style="margin: 5px 0;">
                {{ emp }}:
                勤務日数 {{ counts.get(emp, 0) }}日,
                休日数 {{ off_counts.get(emp, 0) }}日
            </p>
        {% endfor %}
    {% else %}
        <p>表示する従業員がいません。</p>
    {% endif %}
</div>

<form method="post">
    <input type="hidden" name="action" value="complete" id="action-field">
    <table class="calendar">
        <thead>
            <tr>
                <th>Mon</th><th>Tue</th><th>Wed</th><th>Thu</th><th>Fri</th><th>Sat</th><th>Sun</th>
            </tr>
        </thead>
        <tbody>
        {% for week in weeks %}
            <tr>
            {% for d in week %}
                <td class="{% if d.month != month.month %}other-month{% endif %} shift-cell" data-date="{{ d.isoformat() }}">
                    {{ d.day }}
                    <div class="assignments">
                        {% for emp in assignments.get(d.isoformat(), []) %}
                            <span class="assigned">{{ emp }}</span>
                        {% endfor %}
                    </div>
                    <input type="hidden" name="d-{{ d.isoformat() }}" value="{{ ','.join(assignments.get(d.isoformat(), [])) }}">
                </td>
            {% endfor %}
            </tr>
        {% endfor %}
        </tbody>
    </table>
    <button type="submit" onclick="document.getElementById('action-field').value='complete'">完成</button>
    <button type="submit" onclick="document.getElementById('action-field').value='notify'">告知</button>
</form>
<p><a href="{{ url_for('calendario.shift_rules') }}">シフト計算詳細設定</a></p>
<p><a href="{{ url_for('calendario.index', month=month.strftime('%Y-%m')) }}">戻る</a></p>
<script src="{{ url_for('static', filename='js/shift_manager.js') }}" defer></script>
{% endblock %}
