# 既知の問題と対処法

## 解決済みの問題 (本セッションで対応: 2025-06-09)

### 1. イベント編集フォームで 'time' 属性エラー
- **現象**: `jinja2.exceptions.UndefinedError: 'app.calendario.forms.EventForm object' has no attribute 'time'`
- **原因**: `forms.py` で `time` フィールドが `start_time` と `end_time` に分割されたが、テンプレート (`event_form.html`) が古い `form.time` を参照していた。
- **対処法**: `event_form.html` を修正し、`form.start_time` と `form.end_time` を使用するように変更。
- **恒久対策**: 完了。

### 2. 日付セルの幅と予定ボックスの幅の不整合
- **現象**: カレンダーの日付セルの幅と、内部に表示される予定ボックスの幅が視覚的に合っていなかった。
- **原因**: CSSの幅指定が不適切だった。
- **対処法**: `static/css/style.css` を修正し、セル幅を180px、予定ボックス幅を170pxに統一的に調整。カレンダー全体の幅も更新。
- **恒久対策**: 完了。

### 3. メインカレンダーの詳細ボタンが反応しない・古いUIが残存
- **現象**: 詳細ボタンが機能せず、古いモーダルUIが表示される可能性があった。
- **原因**: JavaScriptのイベントハンドリング不備、古いUIコードの残存。
- **対処法**: `month_view.html` から古いUIとJSを削除。`calendar_event_details.js` のクリックハンドラを修正し、`showCalendarioPopup` を使用して詳細表示するように統一。イベント要素に `data-*` 属性を追加。
- **恒久対策**: 完了。

### 4. シフト管理エリアのカレンダー表示範囲が不適切
- **現象**: 前2週間が表示され、月末が表示されないなど、表示範囲が期待通りでなかった。
- **原因**: `app/calendario/utils.py` の `get_calendar_weeks_for_month` 関数のロジック不備。
- **対処法**: `get_calendar_weeks_for_month` を修正し、指定月の前後1週間を完全に含むように（週の開始は月曜、終了は日曜に調整）。
- **恒久対策**: 完了。

### 5. 特定イベントカテゴリのカラーが未適用
- **現象**: 「出張(shucchou)」と「マミー系(mummy)」イベントに指定の背景色が適用されていなかった。
- **原因**: CSSクラス名とカテゴリ名のマッピング不備、またはCSS定義漏れ。
- **対処法**: `static/css/style.css` に `.event-shucchou` と `.event-mummy` のスタイルを定義/修正。`month_view.html` のテンプレートロジックでカテゴリ名を対応するCSSクラスに正しくマッピングするように修正。
- **恒久対策**: 完了。 (`forms.py` でカテゴリ値が 'shucchou', 'mummy' であることを確認済み)

### 6. シフト管理エリアの警告ポップアップとイベント詳細ポップアップのUI不統一
- **現象**: シフト管理エリアの警告が異なるUI（Bootstrap Modal）で表示されていた。
- **原因**: `shift_manager.js` が独自のポップアップ機構を使用していた。
- **対処法**: `shift_manager.js` を修正し、警告表示に `showCalendarioPopup` を使用するように統一。
- **恒久対策**: 完了。

## 残存する問題・確認事項
- **確認事項**: `app/calendario/forms.py` の `EventForm` に `start_time` および `end_time` フィールドが実際に定義されているか（今回の修正の前提）。今回の作業では `event_form.html` のテンプレートエラー解消を主眼とした。
- **[問題点1]** (元のプレースホルダー。必要に応じて具体的な問題に置き換えるか、削除)
    - **現象**: [現象を記述]
    - **原因**: [原因を記述]
    - **対処法**: [対処法を記述]
    - **恒久対策**: [恒久対策を記述]
