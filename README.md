# Famigliapp CLI プロトタイプ

Famigliapp は家族専用のコミュニティアプリを目指したプロジェクトの CLI 版プロトタイプです。Web アプリの前段階として作られており、ユーザーごとのポイント管理や簡易掲示板などの機能をコマンドラインから試すことができます。

## 実行方法

Python 3 がインストールされている環境で、次のコマンドを実行します。

```
python run.py
```

起動後にユーザー名とパスワードを入力するとメニューが表示されます。メニュー項目は次の通りです。

1. **ポイントを見る** ― 各ユーザーのポイント(A/O/U)を確認します。
2. **ポイントを編集する** ― 管理者のみ利用可能。任意ユーザーのポイントを変更します。
3. **投稿を見る** ― 投稿一覧を表示します。カテゴリや投稿者、キーワードによる絞り込みが可能です。
4. **投稿する** ― 新しい投稿を追加します。
5. **投稿を削除する** ― 管理者のみ利用可能。ID を指定して投稿を削除します。
6. **ランキングを見る** ― A・O・U のいずれかのポイントでランキングを表示します。期間は全期間のほか、週間・月間・年間を選択できます。
7. **ポイント履歴を見る** ― ポイント変動履歴を期間やユーザー名で確認します。
8. **投稿を編集する** ― 投稿者本人または管理者が内容を変更します。
9. **intrattenimento を見る** ― intrattenimento掲示板の投稿一覧を表示します。投稿者やキーワードで絞り込み可能です。
10. **intrattenimento に投稿する** ― 新しい intrattenimento 投稿を追加します。タイトル、本文、公開終了日を入力します。
11. **intrattenimento 投稿を削除する** ― 管理者のみ利用可能。ID を指定して intrattenimento 投稿を削除します。
12. **Corso を見る** ― Corso 掲示板の投稿を表示します。
13. **Corso に投稿する** ― 新しい Corso 投稿を追加します。
14. **履歴をCSV出力** ― ポイント履歴をCSV形式で保存します。
15. **Resoconto を見る** ― 業務報告一覧を表示します。
16. **Resoconto に投稿する** ― 新しい業務報告を追加します。
17. **Principessina を見る** ― ベイビー報告の一覧を表示します。
18. **Principessina に投稿する** ― 新しいベイビー報告を追加します。
0. **終了** ― アプリを終了します。

### 投稿のフィルタ

「投稿を見る」を選択すると、カテゴリ、投稿者、検索語をそれぞれ入力して一覧を絞り込めます。空欄の項目は無視されるため、複数条件を組み合わせた検索も可能です。

## ユーザーとパスワード

利用できるアカウント情報は `config.py` の `USERS` 辞書にまとめられています。必要に応じて追加や変更を行ってください。Web 版でセッション管理に使用する `SECRET_KEY` も同ファイル内で設定できます。公開リポジトリにアップロードする場合は適切な値へ変更することを推奨します。

## データファイル

ポイント情報は `points.json`、投稿情報は `posts.json` としてプロジェクトのルートディレクトリに保存されます。初回実行時に自動生成され、アプリの操作内容に応じて更新されます。

## Web 版の起動方法

Flask を使った簡易 Web 版を起動する場合は以下の手順を実行します。

```bash
pip install -r requirements.txt
export FLASK_APP=app
flask run
```

コマンドを実行すると `http://127.0.0.1:5000/` でアクセスできるようになります。

ログイン後、トップページにはポイント管理用の
"Punto ダッシュボード" へのリンクが表示され、`/punto` から利用できます。
ランキングは `/punto/rankings` で閲覧可能です。指標(A/O/U)と期間を選択して表示できます。
ポイント履歴は `/punto/history` から確認できます。ユーザー名と日付でフィルタリング可能です。

掲示板は `/posts` から利用できます。カテゴリ、投稿者、キーワードを指定して一覧を絞り込み、新規投稿は `/posts/add` で行います。管理者は各投稿の "削除" リンクから投稿を削除できます。

ブラヴィッシモ(褒め言葉掲示板)は `/bravissimo` で閲覧できます。管理者のみ `/bravissimo/add` から投稿可能です。

インタッテニメント掲示板は `/intrattenimento` から利用できます。タイトルと本文、公開終了日、添付ファイルを入力して投稿できます。一般ユーザーは公開期間を過ぎた投稿を閲覧できません。
Corso 掲示板は `/corso` から利用できます。タイトル、本文、公開終了日、添付ファイルを指定して投稿し、管理者は削除も行えます。

スカトラ・ディ・カプリッチョ(フィードバック用掲示板)は `/scatola_capriccio` で閲覧できます。一般ユーザーは `/scatola_capriccio/add` からフィードバックを投稿でき、投稿内容は管理者のみ閲覧可能です。

共有カレンダー機能は `/calendario` から利用します。日付とタイトル、内容を入力してイベントを登録できます。管理者は各イベントの "削除" リンクから予定を削除可能です。
業務報告ページ "Resoconto" は `/resoconto` からアクセスできます。ユーザーは日付と内容を入力して報告を投稿できます。管理者は全ユーザーの報告一覧を閲覧し、不要な投稿を削除できます。
ベイビー報告 "Principessina" は `/principessina` から利用できます。文章と添付ファイルを投稿でき、管理者は削除も行えます。

